<!DOCTYPE html>
<html lang="fr">
<head>
<link rel="manifest" href="manifest.webmanifest">
<meta name="theme-color" content="#0b0b0f">
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
<title>Hanzi Flash ‚Äî Audio + Import TSV</title>
<style>
  :root{--bg:#0b0b0f;--fg:#f3f3f5;--muted:#9aa0a6;--accent:#4f8cff;--good:#2ecc71;--bad:#ff5c5c;--card:#15151b;--card2:#1d1d26}
  *{box-sizing:border-box}
  html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif}
  .wrap{max-width:680px;margin:0 auto;padding:env(safe-area-inset-top) 16px calc(16px + env(safe-area-inset-bottom));display:flex;flex-direction:column;height:100%}
  header{display:flex;align-items:center;justify-content:space-between;padding:8px 0;gap:8px}
  h1{font-size:16px;margin:0;color:var(--muted)}
  .stats{font-size:12px;color:var(--muted)}
  .card{flex:1;display:flex;align-items:center;justify-content:center;perspective:1000px;user-select:none;-webkit-user-select:none;touch-action:manipulation;margin:10px 0 14px}
  .face{width:100%;height:100%;max-height:62vh;border-radius:16px;background:linear-gradient(175deg,var(--card),var(--card2));
    box-shadow:0 10px 30px rgba(0,0,0,.35);display:flex;align-items:center;justify-content:center;padding:24px;position:relative;transform-style:preserve-3d;transition:transform .38s ease}
  .face.flipped{transform:rotateY(180deg)}
  .front,.back{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;backface-visibility:hidden;-webkit-backface-visibility:hidden;padding:24px}
  .back{transform:rotateY(180deg)}
  .hanzi{font-size:16vw;line-height:1;font-weight:600}
  @media (min-width:600px){.hanzi{font-size:96px}}
  .pinyin{font-size:6vw;opacity:.9}
  .meaning{font-size:5vw;color:var(--muted)}
  @media (min-width:600px){.pinyin{font-size:28px}.meaning{font-size:22px}}
  .hint{position:absolute;bottom:10px;left:0;right:0;text-align:center;color:var(--muted);font-size:12px}
  .controls{display:flex;gap:10px;flex-wrap:wrap}
  .btn{flex:1;border:none;border-radius:14px;padding:14px 16px;font-size:16px;font-weight:600;cursor:pointer}
  .again{background:rgba(255,92,92,.12);color:var(--bad);border:1px solid rgba(255,92,92,.3)}
  .flip{background:transparent;border:1px dashed #3a3a46;color:var(--muted);flex:0 0 auto}
  .good{background:rgba(46,204,113,.12);color:var(--good);border:1px solid rgba(46,204,113,.3)}
  .sound{background:transparent;border:1px solid #2a2a33;color:var(--fg);flex:0 0 auto}
  .tool{background:transparent;border:1px solid #2a2a33;color:var(--fg);flex:0 0 auto}
  .deck-tools{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
  .link{font-size:12px;color:var(--accent);background:none;border:none;padding:0;text-decoration:underline;cursor:pointer}
  dialog{border:none;border-radius:14px;background:#11131a;color:var(--fg);max-width:680px;width:92vw;padding:0}
  dialog::backdrop{background:rgba(0,0,0,.6)}
  .sheet{padding:16px;display:flex;flex-direction:column;gap:12px}
  textarea{width:100%;min-height:40vh;border-radius:10px;background:#0c0e15;color:var(--fg);border:1px solid #2a2a33;padding:12px;font-family:ui-monospace,Menlo,Consolas,monospace;font-size:12px}
  .row{display:flex;gap:10px;justify-content:flex-end}
  .small{font-size:12px;color:var(--muted)}
  .pill{font-size:11px;color:#cbd1d8;background:#0c0e15;border:1px solid #2a2a33;border-radius:999px;padding:6px 10px}
</style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Hanzi ‚Äî Audio Flashcards</h1>
      <div class="stats" id="stats">0 d√ªes ¬∑ 0 ma√Ætris√©es</div>
    </header>

    <div class="card" id="cardArea">
      <div class="face" id="face">
        <div class="front">
          <div class="hanzi" id="hanzi">Êàë</div>
          <div class="hint">Tape/Click pour retourner ‚Ä¢ swipe ‚Üê/‚Üí ‚Ä¢ double-tap üîä</div>
        </div>
        <div class="back">
          <div class="pinyin" id="pinyin">w«í</div>
          <div class="meaning" id="meaning">je / moi</div>
          <div class="pill" id="audioInfo" style="display:none;">Audio</div>
        </div>
      </div>
    </div>

    <div class="controls">
      <button class="btn again" id="btnAgain">Encore</button>
      <button class="btn flip" id="btnFlip">Retourner</button>
      <button class="btn good" id="btnGood">OK</button>
      <button class="btn sound" id="btnSound">üîä √âcouter</button>
      <button class="btn tool" id="btnImport">Importer TSV</button>
    </div>

    <div class="deck-tools">
      <button class="link" id="reset">Remise √† z√©ro</button>
      <button class="link" id="exportJson">Exporter (JSON)</button>
    </div>
  </div>

  <dialog id="dlg">
    <div class="sheet">
      <strong>Importer un deck depuis TSV (Excel/Google Sheets)</strong>
      <div class="small">Colonnes attendues¬†: caract√®re (A) ‚Äî pinyin (B) ‚Äî traduction (C) ‚Äî URL mp3 (D). S√©parateur¬†: tabulation.</div>
      <textarea id="tsv"></textarea>
      <div class="row">
        <button class="link" id="cancelDlg">Annuler</button>
        <button class="link" id="saveTsv">Importer</button>
      </div>
    </div>
  </dialog>

<script>
(function(){
  // ===== TSV par d√©faut (pr√©rempli depuis ton message) =====
  const DEFAULT_TSV = `Êàë\tw«í\tje / moi\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%88%91&tl=zh-CN&client=tw-ob
‰Ω†\tn«ê\ttu / toi\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BD%A0&tl=zh-CN&client=tw-ob
‰ªñ\ttƒÅ\til / lui\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BB%96&tl=zh-CN&client=tw-ob
Â•π\ttƒÅ\telle\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A5%B9&tl=zh-CN&client=tw-ob
Êàë‰ª¨\tw«ímen\tnous\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%88%91%E4%BB%AC&tl=zh-CN&client=tw-ob
‰Ω†‰ª¨\tn«êmen\tvous\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BD%A0%E4%BB%AC&tl=zh-CN&client=tw-ob
‰ªñ‰ª¨\ttƒÅmen\tils / eux\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BB%96%E4%BB%AC&tl=zh-CN&client=tw-ob
Â•π‰ª¨\ttƒÅmen\telles\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A5%B9%E4%BB%AC&tl=zh-CN&client=tw-ob
Âßì\tx√¨ng\ts'appeler (nom de famille)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A7%93&tl=zh-CN&client=tw-ob
Âè´\tji√†o\ts'appeler (pr√©nom)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8F%AB&tl=zh-CN&client=tw-ob
Â≠¶\txu√©\t√©tudier\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%AD%A6&tl=zh-CN&client=tw-ob
ÊòØ\tsh√¨\t√™tre\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%AF&tl=zh-CN&client=tw-ob
Áîü\tshƒìng\tna√Ætre / √©l√®ve\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%94%9F&tl=zh-CN&client=tw-ob
Êúâ\ty«íu\tavoir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%9C%89&tl=zh-CN&client=tw-ob
ËØ¥\tshu≈ç\tdire / parler\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%AF%B4&tl=zh-CN&client=tw-ob
Âú®\tz√†i\t√™tre (quelque part)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%9C%A8&tl=zh-CN&client=tw-ob
Âéª\tq√π\taller\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8E%BB&tl=zh-CN&client=tw-ob
Êù•\tl√°i\tvenir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%9D%A5&tl=zh-CN&client=tw-ob
Âõû\thu√≠\trevenir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%9B%9E&tl=zh-CN&client=tw-ob
‰Ωè\tzh√π\thabiter / demeurer\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BD%8F&tl=zh-CN&client=tw-ob
Â∑•‰Ωú\tg≈çngzu√≤\ttravailler\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%B7%A5%E4%BD%9C&tl=zh-CN&client=tw-ob
‰ºëÊÅØ\txi≈´xi\tse reposer\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BC%91%E6%81%AF&tl=zh-CN&client=tw-ob
Êâæ\tzh«éo\tchercher\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%89%BE&tl=zh-CN&client=tw-ob
ÈóÆ\tw√®n\tdemander\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E9%97%AE&tl=zh-CN&client=tw-ob
Âñù\thƒì\tboire\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%96%9D&tl=zh-CN&client=tw-ob
ÊÉ≥\txi√¢ng\tvouloir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%83%B3&tl=zh-CN&client=tw-ob
Áü•ÈÅì\tzhƒ´d√†o\tsavoir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%9F%A5%E9%81%93&tl=zh-CN&client=tw-ob
Áúã\tk√†n\tvoir / observer\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%9C%8B&tl=zh-CN&client=tw-ob
‰∏ç\tb√π\tn√©gation\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%8D&tl=zh-CN&client=tw-ob
Ê≤°\tm√©i\tn√©gation (pass√©)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%B2%A1&tl=zh-CN&client=tw-ob
Âë¢\tne\tparticule interrogative\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%91%A2&tl=zh-CN&client=tw-ob
Âêó\tma\tparticule interrogative\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%90%97&tl=zh-CN&client=tw-ob
Âêß\tba\tparticule de suggestion\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%90%A7&tl=zh-CN&client=tw-ob
‰ªÄ‰πà\tsh√©nme\tquoi / que\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BB%80%E4%B9%88&tl=zh-CN&client=tw-ob
Âì™\tn«é\tquel / lequel\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%93%AA&tl=zh-CN&client=tw-ob
Âá†\tj«ê\tcombien (petit nombre) / quelques\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%87%A0&tl=zh-CN&client=tw-ob
Ë∞Å\tsh√©i\tqui ?\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%B0%81&tl=zh-CN&client=tw-ob
‰πü\tyƒõ\taussi\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B9%9F&tl=zh-CN&client=tw-ob
Ëøô\tzh√®\tce / cette\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%BF%99&tl=zh-CN&client=tw-ob
ÁöÑ\tde\tparticule possessive\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%9A%84&tl=zh-CN&client=tw-ob
‰∏™\tg√®\tclassificateur g√©n√©ral\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%AA&tl=zh-CN&client=tw-ob
‰∏§\tli«éng\tdeux (quantit√©)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%A4&tl=zh-CN&client=tw-ob
Êú¨\tbƒõn\tclassificateur pour les livres / racine / origine / fondamentale\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%9C%AC&tl=zh-CN&client=tw-ob
Âè£\tk«íu\tclassificateur membres famille / bouche\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8F%A3&tl=zh-CN&client=tw-ob
‰∏Ä\tyƒ´\tun\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%80&tl=zh-CN&client=tw-ob
‰∫å\t√®r\tdeux\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BA%8C&tl=zh-CN&client=tw-ob
‰∏â\tsƒÅn\ttrois\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%89&tl=zh-CN&client=tw-ob
Âõõ\ts√¨\tquatre\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%9B%9B&tl=zh-CN&client=tw-ob
‰∫î\tw«î\tcinq\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BA%94&tl=zh-CN&client=tw-ob
ÂÖ≠\tli√π\tsix\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%85%AD&tl=zh-CN&client=tw-ob
‰∏É\tqƒ´\tsept\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%83&tl=zh-CN&client=tw-ob
ÂÖ´\tbƒÅ\thuit\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%85%AB&tl=zh-CN&client=tw-ob
‰πù\tji«î\tneuf\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B9%9D&tl=zh-CN&client=tw-ob
ÂçÅ\tsh√≠\tdix\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8D%81&tl=zh-CN&client=tw-ob
Â§öÂ∞ë\tdu≈çsh«éo\tcombien ?\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A4%9A%E5%B0%91&tl=zh-CN&client=tw-ob
Â§öÂ§ß\tdu≈ç d√†\tquel √¢ge ?\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A4%9A%E5%A4%A7&tl=zh-CN&client=tw-ob
Â≤Å\tsu√¨\t√¢ge\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%B2%81&tl=zh-CN&client=tw-ob
Âá†Â≤Å\tj«ê su√¨\tPour les enfants (moins de 10 ans)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%87%A0%E5%B2%81&tl=zh-CN&client=tw-ob
ÊÇ®Â§öÂ§ßÂπ¥Á∫™\tN√≠n du≈ç d√† ni√°nj√¨ ?\tPour √™tre poli avec des personnes √¢g√©es\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%82%A8%E5%A4%9A%E5%A4%A7%E5%B9%B4%E7%BA%AA&tl=zh-CN&client=tw-ob
Âú®\tz√†i\t√™tre (quelque part)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%9C%A8&tl=zh-CN&client=tw-ob
Âì™ÂÑø\tn«ér\to√π\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%93%AA%E5%84%BF&tl=zh-CN&client=tw-ob
Âπ¥\tni√°n\tann√©e\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%B9%B4&tl=zh-CN&client=tw-ob
ÊòüÊúü\txƒ´ngqƒ´\tsemaine\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%9F%E6%9C%9F&tl=zh-CN&client=tw-ob
Êó•\tr√¨\tjour\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%97%A5&tl=zh-CN&client=tw-ob
Âè∑\th√†o\tjour/date (oral)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8F%B7&tl=zh-CN&client=tw-ob
Êúà\tyu√®\tmois\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%9C%88&tl=zh-CN&client=tw-ob
ÊòüÊúüÊó•\txƒ´ngqƒ´r√¨\tdimanche\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%9F%E6%9C%9F%E6%97%A5&tl=zh-CN&client=tw-ob
ÁîüÊó•\tshƒìngr√¨\tanniversaire\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%94%9F%E6%97%A5&tl=zh-CN&client=tw-ob
Âá†\tj«ê\tcombien (petit nombre / heure / √¢ge)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%87%A0&tl=zh-CN&client=tw-ob
‰ªäÂ§©\tjƒ´ntiƒÅn\taujourd'hui\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BB%8A%E5%A4%A9&tl=zh-CN&client=tw-ob
ÊòéÂ§©\tm√≠ngtiƒÅn\tdemain\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%8E%E5%A4%A9&tl=zh-CN&client=tw-ob
Êò®Â§©\tzu√≥tiƒÅn\thier\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%A8%E5%A4%A9&tl=zh-CN&client=tw-ob
‰∏äÂçà\tsh√†ngw«î\tmatin\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%8A%E5%8D%88&tl=zh-CN&client=tw-ob
‰∏≠Âçà\tzh≈çngw«î\tmidi\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%AD%E5%8D%88&tl=zh-CN&client=tw-ob
‰∏ãÂçà\txi√†w«î\tapr√®s-midi\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%8B%E5%8D%88&tl=zh-CN&client=tw-ob
Êó©‰∏ä\tz«éoshang\tmatin (tr√®s t√¥t)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%97%A9%E4%B8%8A&tl=zh-CN&client=tw-ob
Êôö‰∏ä\tw«énshang\tsoir\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%99%9A%E4%B8%8A&tl=zh-CN&client=tw-ob
‰ªäÂπ¥\tjƒ´nni√°n\tcette ann√©e\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BB%8A%E5%B9%B4&tl=zh-CN&client=tw-ob
ÊòéÂπ¥\tm√≠ngni√°n\tl'ann√©e prochaine\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%8E%E5%B9%B4&tl=zh-CN&client=tw-ob
ÂéªÂπ¥\tq√πni√°n\tl'ann√©e derni√®re\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8E%BB%E5%B9%B4&tl=zh-CN&client=tw-ob
Èíü\tzh≈çng\thorloge / utilis√© pour l'heure pr√©cise\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E9%92%9F&tl=zh-CN&client=tw-ob
ÁÇπ\tdi«én\tpoint / unit√© de compte pour l'heure\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%82%B9&tl=zh-CN&client=tw-ob
ÂàÜ\tfƒìn\tminute\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%88%86&tl=zh-CN&client=tw-ob
Âàª\tk√®\tquart d'heure\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%88%BB&tl=zh-CN&client=tw-ob
Âçä\tb√†n\tdemi (30 minutes)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8D%8A&tl=zh-CN&client=tw-ob
‰∏âÁÇπÈíü\tsƒÅn di«én zh≈çng\t3 heures\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%89%E7%82%B9%E9%92%9F&tl=zh-CN&client=tw-ob
‰∏âÁÇπ‰∫îÂàÜ\tsƒÅn di«én w«î fƒìn\t3h05\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%89%E7%82%B9%E4%BA%94%E5%88%86&tl=zh-CN&client=tw-ob
ÂÖ≠ÁÇπ‰∏ÄÂàª\tli√π di«én yƒ´ k√®\t6h15\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%85%AD%E7%82%B9%E4%B8%80%E5%88%BB&tl=zh-CN&client=tw-ob
ÂÖ≠ÁÇπÂçä\tli√π di«én b√†n\t6h30\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%85%AD%E7%82%B9%E5%8D%8A&tl=zh-CN&client=tw-ob
‰∏ÉÁÇπÂ∑Æ‰∏ÄÂàª\tqƒ´ di«én ch√† yƒ´ k√®\t6h45\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%83%E7%82%B9%E5%B7%AE%E4%B8%80%E5%88%BB&tl=zh-CN&client=tw-ob
ÂÖ≠ÁÇπ‰∏âÂàª\tli√π di«én sƒÅn k√®\t6h45 (alternative)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%85%AD%E7%82%B9%E4%B8%89%E5%88%BB&tl=zh-CN&client=tw-ob
Â•Ω\th«éo\tbien\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A5%BD&tl=zh-CN&client=tw-ob
Â§ß\td√†\tgrand\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A4%A7&tl=zh-CN&client=tw-ob
Â∞è\txi«éo\tpetit\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%B0%8F&tl=zh-CN&client=tw-ob
ËÄÅ\tl«éo\tvieux\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%80%81&tl=zh-CN&client=tw-ob
Ëøá\tgu√≤\t(pass√© d'exp√©rience)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%BF%87&tl=zh-CN&client=tw-ob
ÂêçÂ≠ó\tm√≠ngzi\tpr√©nom\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%90%8D%E5%AD%97&tl=zh-CN&client=tw-ob
Âßì\tx√¨ng\tnom de famille\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A7%93&tl=zh-CN&client=tw-ob
‰∫∫\tr√©n\tpersonne\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BA%BA&tl=zh-CN&client=tw-ob
Ëøô‰∏™‰∫∫\tzh√® ge r√©n\tcette personne-ci\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%BF%99%E4%B8%AA%E4%BA%BA&tl=zh-CN&client=tw-ob
ÈÇ£‰∏™‰∫∫\tn√† ge r√©n\tcette personne-l√†\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E9%82%A3%E4%B8%AA%E4%BA%BA&tl=zh-CN&client=tw-ob
ÈÉΩ\td≈çu\ttous / tout\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E9%83%BD&tl=zh-CN&client=tw-ob
ÊúãÂèã\tp√©ngy«íu\tami\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%9C%8B%E5%8F%8B&tl=zh-CN&client=tw-ob
Áî∑ÊúãÂèã\tn√°n p√©ngy«íu\tpetit ami\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%94%B7%E6%9C%8B%E5%8F%8B&tl=zh-CN&client=tw-ob
Â•≥ÊúãÂèã\tn«ö p√©ngy«íu\tpetite amie\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A5%B3%E6%9C%8B%E5%8F%8B&tl=zh-CN&client=tw-ob
ÂßêÂßê\tjiƒõjie\tgrande s≈ìur\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A7%90%E5%A7%90&tl=zh-CN&client=tw-ob
Â¶πÂ¶π\tm√®imei\tpetite s≈ìur\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A6%B9%E5%A6%B9&tl=zh-CN&client=tw-ob
Âì•Âì•\tgƒìge\tgrand fr√®re\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%93%A5%E5%93%A5&tl=zh-CN&client=tw-ob
ÂºüÂºü\td√¨di\tpetit fr√®re\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%BC%9F%E5%BC%9F&tl=zh-CN&client=tw-ob
Áà∏Áà∏\tb√†ba\tpapa\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%88%B8%E7%88%B8&tl=zh-CN&client=tw-ob
Â¶àÂ¶à\tmƒÅma\tmaman\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A6%88%E5%A6%88&tl=zh-CN&client=tw-ob
Â≠©Â≠ê\th√°izi\tenfant\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%AD%A9%E5%AD%90&tl=zh-CN&client=tw-ob
Áà∂ÊØç\tf√πm«î\tparents\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%88%B6%E6%AF%8D&tl=zh-CN&client=tw-ob
Â≠¶Áîü\txu√©shƒìng\t√©tudiant\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%AD%A6%E7%94%9F&tl=zh-CN&client=tw-ob
Â§ßÂ≠¶Áîü\td√†xu√©shƒìng\t√©tudiant (sup√©rieur)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A4%A7%E5%AD%A6%E7%94%9F&tl=zh-CN&client=tw-ob
‰∏≠Â≠¶Áîü\tzh≈çngxu√©shƒìng\t√©l√®ve du secondaire\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%AD%E5%AD%A6%E7%94%9F&tl=zh-CN&client=tw-ob
Â∞èÂ≠¶Áîü\txi«éoxu√©shƒìng\t√©l√®ve du primaire\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%B0%8F%E5%AD%A6%E7%94%9F&tl=zh-CN&client=tw-ob
ÂçöÂ£´\tb√≥sh√¨\tdocteur (titre acad√©mique)\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8D%9A%E5%A3%AB&tl=zh-CN&client=tw-ob
Ê±âËØ≠\th√†ny«î\tlangue chinoise\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%B1%89%E8%AF%AD&tl=zh-CN&client=tw-ob
Êó•ËØ≠\tr√¨y«î\tlangue japonaise\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%97%A5%E8%AF%AD&tl=zh-CN&client=tw-ob
Ê≥ïËØ≠\tf«éy«î\tlangue fran√ßaise\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%B3%95%E8%AF%AD&tl=zh-CN&client=tw-ob
Ëã±ËØ≠\tyƒ´ngy«î\tlangue anglaise\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%8B%B1%E8%AF%AD&tl=zh-CN&client=tw-ob
Âæ∑ËØ≠\td√©y«î\tlangue allemande\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%BE%B7%E8%AF%AD&tl=zh-CN&client=tw-ob
Êñá\tw√©n\t√©criture / langue\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%96%87&tl=zh-CN&client=tw-ob
ÂéÜÂè≤\tl√¨sh«ê\thistoire\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8E%86%E5%8F%B2&tl=zh-CN&client=tw-ob
Ëâ∫ÊúØ\ty√¨sh√π\tart\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%89%BA%E6%9C%AF&tl=zh-CN&client=tw-ob
ÊñáÂ≠¶\tw√©nxu√©\tlitt√©rature\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%96%87%E5%AD%A6&tl=zh-CN&client=tw-ob
Êï∞Â≠¶\tsh√πxu√©\tmath√©matiques\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%95%B0%E5%AD%A6&tl=zh-CN&client=tw-ob
‰∏≠ÂõΩ\tzh≈çnggu√≥\tChine\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%AD%E5%9B%BD&tl=zh-CN&client=tw-ob
Âåó‰∫¨\tbƒõijƒ´ng\tP√©kin\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8C%97%E4%BA%AC&tl=zh-CN&client=tw-ob
Ê≥ïÂõΩ\tf«égu√≥\tFrance\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%B3%95%E5%9B%BD&tl=zh-CN&client=tw-ob
ËΩ¶\tchƒì\tv√©hicule\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%BD%A6&tl=zh-CN&client=tw-ob
Ê±ΩËΩ¶\tq√¨chƒì\tvoiture\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%B1%BD%E8%BD%A6&tl=zh-CN&client=tw-ob
Ëá™Ë°åËΩ¶\tz√¨x√≠ngchƒì\tv√©lo\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%87%AA%E8%A1%8C%E8%BD%A6&tl=zh-CN&client=tw-ob
ÂõΩ\tgu√≥\tpays\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%9B%BD&tl=zh-CN&client=tw-ob
‰∫∫Âè£\tr√©nk«íu\tpopulation\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%BA%BA%E5%8F%A3&tl=zh-CN&client=tw-ob
ÂåóÊñπ‰∫∫\tbƒõifƒÅngr√©n\tgens du nord\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8C%97%E6%96%B9%E4%BA%BA&tl=zh-CN&client=tw-ob
ÂçóÊñπ‰∫∫\tn√°nfƒÅngr√©n\tgens du sud\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8D%97%E6%96%B9%E4%BA%BA&tl=zh-CN&client=tw-ob
‰∏≠\tzh≈çng\tau centre / milieu\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%AD&tl=zh-CN&client=tw-ob
Âåó\tbƒõi\tnord\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8C%97&tl=zh-CN&client=tw-ob
Âçó\tn√°n\tsud\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%8D%97&tl=zh-CN&client=tw-ob
‰∏ú\td≈çng\test\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%9C&tl=zh-CN&client=tw-ob
Ë•ø\txƒ´\touest\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%A5%BF&tl=zh-CN&client=tw-ob
Ëå∂\tch√°\tth√©\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E8%8C%B6&tl=zh-CN&client=tw-ob
ÊòØ\tsh√¨\tOui\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E6%98%AF&tl=zh-CN&client=tw-ob
‰∏ç\tb√π\tnon\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E4%B8%8D&tl=zh-CN&client=tw-ob
Á∫¢\th√≥ng\trouge\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E7%BA%A2&tl=zh-CN&client=tw-ob
Â•∂\tn√¢i\tlait\thttps://translate.google.com/translate_tts?ie=UTF-8&q=%E5%A5%B6&tl=zh-CN&client=tw-ob`;

  // ===== Parse TSV -> deck =====
  function parseTSV(tsv){
    const lines = (tsv||"").replace(/\r\n?/g,"\n").split("\n");
    const arr = [];
    for(const raw of lines){
      const line = raw.trim();
      if(!line || line.startsWith("#")) continue;
      // split by tabs; fallback to 2+ spaces
      const cols = line.split(/\t+/);
      if(cols.length < 3) continue;
      const [hanzi, pinyin, meaning, audio] = cols;
      if(!hanzi) continue;
      arr.push({hanzi:hanzi.trim(), pinyin:(pinyin||"").trim(), meaning:(meaning||"").trim(), audio:(audio||"").trim()});
    }
    return arr;
  }

  // ===== Spaced repetition (ultra simple) =====
  const INTERVALS = [0, 60e3, 10*60e3, 60*60e3, 24*60*60e3, 3*24*60*60e3];
  const LS_KEY = "cn_flash_audio_tsv_v1";

  let state = loadState();

  function loadState(){
    try{
      const raw = localStorage.getItem(LS_KEY);
      if(raw){
        const obj = JSON.parse(raw);
        if(Array.isArray(obj.cards) && obj.cards.length) return obj;
      }
    }catch(e){}
    const rows = parseTSV(DEFAULT_TSV);
    const cards = rows.map((c,i)=>({
      id: i+"_"+c.hanzi, ...c, score:0, nextDue:0, seen:0, good:0, again:0
    }));
    if(!cards.length){
      // fallback minimal deck
      cards.push({id:"0_Êàë", hanzi:"Êàë", pinyin:"w«í", meaning:"je / moi", audio:"", score:0,nextDue:0,seen:0,good:0,again:0});
    }
    shuffle(cards);
    const st = {cards, currentId: cards[0].id, flipped:false, createdAt: Date.now()};
    save(st); return st;
  }
  function save(o=state){ localStorage.setItem(LS_KEY, JSON.stringify(o)); }
  function shuffle(a){ for(let i=a.length-1;i>0;i--){ const j=Math.floor(Math.random()*(i+1)); [a[i],a[j]]=[a[j],a[i]]; } }
  function now(){ return Date.now(); }
  function current(){ return state.cards.find(c=>c.id===state.currentId)||state.cards[0]; }

  function pickNext(){
    const due = state.cards.filter(c=>c.nextDue<=now());
    let next = null;
    if(due.length){
      due.sort((a,b)=>a.score-b.score || a.seen-b.seen);
      next = due[0];
    }else{
      next = state.cards.slice().sort((a,b)=>a.nextDue-b.nextDue)[0];
    }
    state.currentId = next.id; state.flipped = false; save(); render();
  }

  // ===== UI =====
  const face = document.getElementById('face');
  const hanziEl = document.getElementById('hanzi');
  const pinyinEl = document.getElementById('pinyin');
  const meaningEl = document.getElementById('meaning');
  const audioInfo = document.getElementById('audioInfo');
  const statsEl = document.getElementById('stats');
  const btnFlip = document.getElementById('btnFlip');
  const btnAgain = document.getElementById('btnAgain');
  const btnGood = document.getElementById('btnGood');
  const btnSound = document.getElementById('btnSound');
  const btnImport = document.getElementById('btnImport');
  const resetBtn = document.getElementById('reset');
  const exportBtn = document.getElementById('exportJson');
  const cardArea = document.getElementById('cardArea');
  const dlg = document.getElementById('dlg');
  const tsvTA = document.getElementById('tsv');
  const cancelDlgBtn = document.getElementById('cancelDlg');
  const saveTsvBtn = document.getElementById('saveTsv');

  let audio = new Audio();
  audio.preload = "none";

  function render(){
    const c = current();
    hanziEl.textContent = c.hanzi || "";
    pinyinEl.textContent = c.pinyin || "";
    meaningEl.textContent = c.meaning || "";
    audioInfo.style.display = c.audio ? "" : "none";
    face.classList.toggle('flipped', state.flipped);
    const dueCount = state.cards.filter(x=>x.nextDue<=now()).length;
    const mastered = state.cards.filter(x=>x.score>=INTERVALS.length-1).length;
    statsEl.textContent = `${dueCount} d√ªes ¬∑ ${mastered} ma√Ætris√©es`;
  }

  function flip(){ state.flipped = !state.flipped; save(); render(); }
  function answerGood(){
    const c = current(); c.seen++; c.good++;
    c.score = Math.min(c.score+1, INTERVALS.length-1);
    c.nextDue = now() + INTERVALS[c.score];
    save(); pickNext();
  }
  function answerAgain(){
    const c = current(); c.seen++; c.again++;
    c.score = Math.max(0, c.score-1);
    c.nextDue = now() + 30e3; // revoit vite
    save(); pickNext();
  }
  async function playAudio(){
    const c = current();
    if(!c.audio) return;
    try{
      // iOS/Android need a user gesture; here it's button-triggered.
      if(audio.src !== c.audio){ audio.src = c.audio; }
      await audio.play();
    }catch(err){
      alert("Impossible de lire l'audio (peut √™tre bloqu√© par le site). Essaie d'ouvrir le fichier via HTTPS sur un domaine (OVH/Drive), ou v√©rifie l'URL.");
    }
  }

  // Gestes & boutons
  btnFlip.addEventListener('click', flip);
  btnGood.addEventListener('click', answerGood);
  btnAgain.addEventListener('click', answerAgain);
  btnSound.addEventListener('click', playAudio);
  face.addEventListener('click', flip);
  // Double-tap sur la carte -> jouer l'audio
  let lastTap = 0;
  face.addEventListener('touchend', (e)=>{
    const t = Date.now();
    if(t - lastTap < 300){ playAudio(); }
    lastTap = t;
  }, {passive:true});

  let startX=null,startY=null;
  cardArea.addEventListener('touchstart', e=>{
    const t=e.changedTouches[0]; startX=t.clientX; startY=t.clientY;
  },{passive:true});
  cardArea.addEventListener('touchend', e=>{
    const t=e.changedTouches[0]; if(startX===null) return;
    const dx=t.clientX-startX, dy=t.clientY-startY;
    if(Math.abs(dx)>40 && Math.abs(dx)>Math.abs(dy)){ dx>0?answerGood():answerAgain(); }
    else{ flip(); }
    startX=startY=null;
  },{passive:true});

  window.addEventListener('keydown', e=>{
    if(e.key===' '){e.preventDefault();flip();}
    if(e.key==='ArrowRight'){e.preventDefault();answerGood();}
    if(e.key==='ArrowLeft'){e.preventDefault();answerAgain();}
    if(e.key==='Enter'){e.preventDefault();playAudio();}
  });

  // Import / Export / Reset
  btnImport.addEventListener('click', ()=>{
    // Pr√©-remplir avec l'export actuel pour servir de mod√®le
    const tsv = state.cards.map(({hanzi,pinyin,meaning,audio})=>[hanzi,pinyin,meaning,audio||""].join("\t")).join("\n");
    tsvTA.value = tsv || DEFAULT_TSV;
    dlg.showModal();
  });
  cancelDlgBtn.addEventListener('click', ()=> dlg.close());
  saveTsvBtn.addEventListener('click', ()=>{
    try{
      const rows = parseTSV(tsvTA.value);
      if(!rows.length) throw new Error("TSV vide");
      const cards = rows.map((c,i)=>({
        id: i+"_"+(c.hanzi||("id"+i)), ...c, score:0, nextDue:0, seen:0, good:0, again:0
      }));
      shuffle(cards);
      state = {cards, currentId: cards[0].id, flipped:false, createdAt: Date.now()};
      save();
      dlg.close();
      render();
    }catch(e){
      alert("Impossible d'importer le TSV. V√©rifie que chaque ligne contient au moins 3 colonnes s√©par√©es par TAB (caract√®re\\tpinyin\\ttraduction[\\taudio]).");
    }
  });

  resetBtn.addEventListener('click', ()=>{
    if(confirm("Remise √† z√©ro (progr√®s + deck) ?")){
      localStorage.removeItem(LS_KEY);
      state = loadState();
      render();
    }
  });
  exportBtn.addEventListener('click', ()=>{
    const data = {
      deck: state.cards.map(({hanzi,pinyin,meaning,audio,score,nextDue,seen,good,again})=>({hanzi,pinyin,meaning,audio,score,nextDue,seen,good,again})),
      exportedAt: new Date().toISOString()
    };
    const blob = new Blob([JSON.stringify(data,null,2)], {type:"application/json"});
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url; a.download = 'flashcards-cn-audio.json';
    document.body.appendChild(a); a.click(); a.remove();
    URL.revokeObjectURL(url);
  });

  // Boot
  pickNext();
})();
</script>
</body>
</html>
