<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover" />
  <title>Hanzi Flash ‚Äî Clean Mobile</title>

  <!-- PWA -->
  <link rel="manifest" href="manifest.webmanifest">
  <meta name="theme-color" content="#0b0b0f">
  <script>
  if ('serviceWorker' in navigator) {
    window.addEventListener('load', ()=> navigator.serviceWorker.register('./sw.js'));
  }
  </script>

  <style>
    :root{--bg:#0b0b0f;--fg:#f3f3f5;--muted:#9aa0a6;--accent:#4f8cff;--good:#2ecc71;--bad:#ff5c5c;--card:#15151b;--card2:#1d1d26}
    *{box-sizing:border-box}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--fg);font-family:system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif;overflow:hidden}
    .wrap{max-width:680px;margin:0 auto;padding:env(safe-area-inset-top) 16px calc(16px + env(safe-area-inset-bottom));display:flex;flex-direction:column;height:100%}

    header{display:flex;align-items:center;justify-content:space-between;padding:8px 0;gap:8px}
    h1{font-size:16px;margin:0;color:var(--muted)}
    .stats{font-size:12px;color:var(--muted)}

    .card{flex:1;display:flex;align-items:center;justify-content:center;perspective:1000px;user-select:none;-webkit-user-select:none;touch-action:manipulation;margin:10px 0 14px}
    .face{
      width:100%;height:100%;max-height:62vh;border-radius:16px;
      background:linear-gradient(175deg,var(--card),var(--card2));
      box-shadow:0 10px 30px rgba(0,0,0,.35);
      display:flex;align-items:center;justify-content:center;padding:24px;position:relative;
      transform-style:preserve-3d;transition:transform .38s ease;
    }
    .face.flipped{transform:rotateY(180deg)}
    .front,.back{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:14px;backface-visibility:hidden;-webkit-backface-visibility:hidden;padding:24px}
    .back{transform:rotateY(180deg)}
    .hanzi{font-size:16vw;line-height:1;font-weight:600}
    @media (min-width:600px){.hanzi{font-size:96px}}
    .pinyin{font-size:6vw;opacity:.9}
    .meaning{font-size:5vw;color:var(--muted)}
    @media (min-width:600px){.pinyin{font-size:28px}.meaning{font-size:22px}}
    .hint{position:absolute;bottom:10px;left:0;right:0;text-align:center;color:var(--muted);font-size:12px}
    .pill{font-size:11px;color:#cbd1d8;background:#0c0e15;border:1px solid #2a2a33;border-radius:999px;padding:6px 10px}

    /* Controls (desktop) */
    .controls{display:flex;gap:10px;flex-wrap:wrap}
    .btn{flex:1;border:none;border-radius:14px;padding:14px 16px;font-size:16px;font-weight:600;cursor:pointer}
    .again{background:rgba(255,92,92,.12);color:var(--bad);border:1px solid rgba(255,92,92,.3)}
    .flip{background:transparent;border:1px dashed #3a3a46;color:var(--muted);flex:0 0 auto}
    .good{background:rgba(46,204,113,.12);color:var(--good);border:1px solid rgba(46,204,113,.3)}
    .sound{background:transparent;border:1px solid #2a2a33;color:var(--fg);flex:0 0 auto}
    .tool{background:transparent;border:1px solid #2a2a33;color:var(--fg);flex:0 0 auto}
    .deck-tools{display:flex;gap:8px;margin-top:8px;flex-wrap:wrap}
    .link{font-size:12px;color:var(--accent);background:none;border:none;padding:0;text-decoration:underline;cursor:pointer}

    dialog{border:none;border-radius:14px;background:#11131a;color:var(--fg);max-width:680px;width:92vw;padding:0}
    dialog::backdrop{background:rgba(0,0,0,.6)}
    .sheet{padding:16px;display:flex;flex-direction:column;gap:12px}

    /* ---- Mobile √©pur√© : uniquement la carte visible ---- */
    @media (max-width:640px){
      header, .controls, .deck-tools, .hint { display:none !important; }
      .wrap{ padding-top: env(safe-area-inset-top); }
      .face{ max-height: 78vh; }
    }

    /* ---- Drag/Swipe animation ---- */
    @keyframes swipeRight { to { transform: translateX(120%) rotate(12deg); opacity:.0; } }
    @keyframes swipeLeft  { to { transform: translateX(-120%) rotate(-12deg); opacity:.0; } }
    .swipe-right { animation: swipeRight .25s ease-out forwards; }
    .swipe-left  { animation: swipeLeft  .25s ease-out forwards; }
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Hanzi ‚Äî Audio Flashcards</h1>
      <div class="stats" id="stats">0 d√ªes ¬∑ 0 ma√Ætris√©es</div>
    </header>

    <div class="card" id="cardArea">
      <div class="face" id="face">
        <div class="front">
          <div class="hanzi" id="hanzi">Êàë</div>
          <div class="hint">tap = retourner ‚Ä¢ appui long = üîä ‚Ä¢ swipe ‚Üê/‚Üí</div>
        </div>
        <div class="back">
          <div class="pinyin" id="pinyin">w«í</div>
          <div class="meaning" id="meaning">je / moi</div>
          <div class="pill" id="audioInfo">Audio</div>
        </div>
      </div>
    </div>

    <!-- Contr√¥les desktop -->
    <div class="controls">
      <button class="btn again" id="btnAgain">Encore</button>
      <button class="btn flip" id="btnFlip">Retourner</button>
      <button class="btn good" id="btnGood">OK</button>
      <button class="btn sound" id="btnSound">üîä √âcouter</button>
      <button class="btn tool" id="btnImport">Importer TSV</button>
    </div>
    <div class="deck-tools">
      <button class="link" id="reset">Remise √† z√©ro</button>
      <button class="link" id="exportJson">Exporter (JSON)</button>
    </div>
  </div>

  <!-- Import TSV -->
  <dialog id="dlg">
    <div class="sheet">
      <strong>Importer un deck depuis TSV</strong>
      <textarea id="tsv"></textarea>
      <div><button onclick="dlg.close()">Fermer</button></div>
    </div>
  </dialog>

  <!-- Stats dialog -->
  <dialog id="statsDlg">
    <div class="sheet">
      <h3>Stats</h3>
      <div id="statsTable"></div>
      <div><button onclick="statsDlg.close()">Fermer</button></div>
    </div>
  </dialog>

<script>
(function(){
  const INTERVALS=[0,60000,600000,3600000,86400000];
  const LS_KEY="cn_flash";
  let state=loadState();
  function loadState(){
    return {cards:[{hanzi:"Êàë",pinyin:"w«í",meaning:"je / moi",score:0,nextDue:0}],currentId:"0",flipped:false};
  }
  function current(){return state.cards[0];}
  function render(){
    const c=current();
    hanziEl.textContent=c.hanzi;pinyinEl.textContent=c.pinyin;meaningEl.textContent=c.meaning;
    face.classList.toggle("flipped",state.flipped);
  }
  const face=document.getElementById("face");
  const hanziEl=document.getElementById("hanzi");
  const pinyinEl=document.getElementById("pinyin");
  const meaningEl=document.getElementById("meaning");
  const statsDlg=document.getElementById("statsDlg");
  const statsTable=document.getElementById("statsTable");

  function flip(){state.flipped=!state.flipped;render();}
  function answer(good){render();}
  function openStats(){statsTable.textContent="Cartes : "+state.cards.length;statsDlg.showModal();}

  face.addEventListener("click",flip);

  let startX=null,startY=null,longPressTimer=null,longPressFired=false;
  cardArea.addEventListener("touchstart",e=>{
    const t=e.changedTouches[0];startX=t.clientX;startY=t.clientY;longPressFired=false;
    longPressTimer=setTimeout(()=>{
      longPressFired=true;
      if(startX<window.innerWidth/2 && startY>window.innerHeight*0.7) openStats();
      else console.log("üîä jouer audio ici");
    },500);
  });
  cardArea.addEventListener("touchmove",e=>{
    const t=e.changedTouches[0];if(Math.abs(t.clientX-startX)>10||Math.abs(t.clientY-startY)>10)clearTimeout(longPressTimer);
  });
  cardArea.addEventListener("touchend",e=>{
    clearTimeout(longPressTimer);
    const dx=e.changedTouches[0].clientX-startX,dy=e.changedTouches[0].clientY-startY;
    if(Math.abs(dx)>60 && Math.abs(dx)>Math.abs(dy)){
      const cls=dx>0?"swipe-right":"swipe-left";face.classList.add(cls);
      face.addEventListener("animationend",()=>{face.classList.remove(cls);answer(dx>0);},{once:true});
    }
  });

  render();
})();
</script>
</body>
</html>
